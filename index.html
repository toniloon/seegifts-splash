<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Splash</title>
<style>
  @import url("https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap");
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background:#0f0f0f; width:100vw; height:100vh; overflow:hidden; opacity:1; transition:opacity .8s ease; }
  canvas { width:100vw; height:100vh; display:block; image-rendering:pixelated; }
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
/* ---------------- SPEED MULTIPLIER ---------------- */
const SPEED = 1.30;   // ← ускорение всей анимации на 30%

/* ---------------- CANVAS ---------------- */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* ---------------- PIXEL FONT ---------------- */
const FONT = {
A:["01110","10001","10001","11111","10001","10001","10001"],
B:["11110","10001","10001","11110","10001","10001","11110"],
C:["01111","10000","10000","10000","10000","10000","01111"],
D:["11110","10001","10001","10001","10001","10001","11110"],
E:["11111","10000","10000","11110","10000","10000","11111"],
F:["11111","10000","10000","11110","10000","10000","10000"],
G:["01111","10000","10000","10111","10001","10001","01111"],
H:["10001","10001","10001","11111","10001","10001","10001"],
I:["11111","00100","00100","00100","00100","00100","11111"],
J:["11111","00010","00010","00010","00010","10010","01100"],
K:["10001","10010","10100","11000","10100","10010","10001"],
L:["10000","10000","10000","10000","10000","10000","11111"],
M:["10001","11011","10101","10001","10001","10001","10001"],
N:["10001","11001","10101","10011","10001","10001","10001"],
O:["01110","10001","10001","10001","10001","10001","01110"],
P:["11110","10001","10001","11110","10000","10000","10000"],
Q:["01110","10001","10001","10001","10101","10010","01101"],
R:["11110","10001","10001","11110","10100","10010","10001"],
S:["01111","10000","10000","01110","00001","00001","11110"],
T:["11111","00100","00100","00100","00100","00100","00100"],
U:["10001","10001","10001","10001","10001","10001","01110"],
V:["10001","10001","10001","10001","10001","01010","00100"],
W:["10001","10001","10001","10001","10101","11011","10001"],
X:["10001","10001","01010","00100","01010","10001","10001"],
Y:["10001","10001","01010","00100","00100","00100","00100"],
Z:["11111","00001","00010","00100","01000","10000","11111"],
" ":["00000","00000","00000","00000","00000","00000","00000"]
};

function buildPixels(text, ps){
  const px=[];
  let cx=0;
  for(const ch of text.toUpperCase()){
    const bm = FONT[ch] || FONT[" "];
    bm.forEach((row,ry)=>{
      [...row].forEach((bit,rx)=>{
        if(bit==="1") px.push({x:cx+rx*ps,y:ry*ps});
      });
    });
    cx += (bm[0].length+1)*ps;
  }
  return {px, width:cx};
}

function drawText(ctx,text,x,y,ps,color,progress,alpha=1){
  const {px} = buildPixels(text,ps);
  const count = Math.floor(px.length * progress);
  ctx.save();
  ctx.globalAlpha = alpha;
  ctx.fillStyle = color;
  for(let i=0;i<count;i++){
    ctx.fillRect(x+px[i].x, y+px[i].y, ps-1, ps-1);
  }
  ctx.restore();
}

function pixelW(text,ps){
  let w=0;
  for(const ch of text.toUpperCase()){
    const bm = FONT[ch]||FONT[" "];
    w += (bm[0].length+1)*ps;
  }
  return w;
}

/* ---------------- STARS ---------------- */
const STARS = Array.from({length:40},()=>({
  x:Math.random(), y:Math.random(),
  size:Math.random()<0.5?3:5,
  dur:0.6+Math.random()*0.8,
  phase:Math.random()*Math.PI*2
}));

function drawStars(t,W,H){
  for(const s of STARS){
    const ph = (t/s.dur + s.phase)%(Math.PI*2);
    const a = 0.2 + 0.8*(0.5+0.5*Math.sin(ph));
    ctx.fillStyle="white";
    ctx.globalAlpha=a;
    ctx.fillRect(s.x*W-s.size/2, s.y*H-s.size/2, s.size, s.size);
  }
  ctx.globalAlpha=1;
}

/* ---------------- CAT ---------------- */
const Gc="#888", Pc="#FFB7C5", Bc="#000";

const frame1=[
["t",Bc,Bc,Bc,Bc,Bc,Bc,Bc,Bc,"t"],
[Bc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Bc],
[Bc,Gc,Pc,Gc,Gc,Pc,Pc,Gc,Gc,Bc],
[Bc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Bc],
[Bc,Gc,Bc,Gc,Gc,Gc,Bc,Gc,Gc,Bc],
[Bc,Gc,Gc,Gc,Pc,Gc,Gc,Gc,Gc,Bc],
[Bc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Bc],
["t",Bc,Bc,Bc,Bc,Bc,Bc,Bc,Bc,"t"]
];

const frame2=[
["t",Bc,Bc,Bc,Bc,Bc,Bc,Bc,Bc,"t"],
[Bc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Bc],
[Bc,Gc,Pc,Gc,Gc,Pc,Pc,Gc,Gc,Bc],
[Bc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Gc,Bc],
[Bc,Gc,Bc,Gc,Gc,Gc,Bc,Gc,Gc,Bc],
[Bc,Gc,Gc,Gc,Pc,Gc,Gc,Gc,Gc,Bc],
[Bc,Gc,Gc,"#555",Gc,"#555",Gc,Gc,Gc,Bc],
["t",Bc,Bc,Bc,Bc,Bc,Bc,Bc,Bc,"t"]
];

const CAT_FRAMES=[frame1,frame2];

function drawCat(fi,ox,oy,S){
  const PX=9*S;
  ctx.save();

  // тряска головы
  const bobY = fi === 0 ? 0 : -3 * S;
  ctx.translate(0, bobY);

  ctx.fillStyle="#E8C49A";
  ctx.fillRect(ox+5*S, oy+15*S, 90*S, 55*S);
  ctx.fillStyle="#FF8FB0";
  ctx.fillRect(ox+12*S, oy+20*S, 76*S, 42*S);

  CAT_FRAMES[fi].forEach((row,ry)=>
    row.forEach((col,rx)=>{
      if(col==="t") return;
      ctx.fillStyle=col;
      ctx.fillRect(ox+(10+rx*9)*S, oy+ry*9*S, PX, PX);
    })
  );
  ctx.restore();
}

/* ---------------- STATIC RAINBOW ---------------- */
const RAINBOW=["#F41AA9","#BF047E","#AE005F","#842769","#2F394E","#E377B7"];
const RW_BASE=340;
const SH_BASE=22;

function drawNyanBlock(blockX,centerY,S,t){
  const rW=RW_BASE*S;
  const rH=SH_BASE*S;
  const totalH=rH*6;
  const rainbowY=centerY-totalH/2;

  const snappedX = Math.round(blockX);
  const rightEdge = snappedX + rW;

  RAINBOW.forEach((c,i)=>{
    ctx.fillStyle=c;
    ctx.fillRect(
      rightEdge - rW,
      rainbowY + i*rH,
      rW,
      rH
    );
  });

  ctx.save();
  ctx.fillStyle="#080808";
  ctx.font=`${Math.round(73*S)}px 'Bebas Neue'`;
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText("seegifts", snappedX+rW/2, centerY);
  ctx.restore();

  return {
    catX: rightEdge - 4*S,
    catY: centerY - 40*S
  };
}

/* ---------------- ANIMATION ---------------- */

/* ускоренные тайминги */
const FADE = 0.5 / SPEED;
const HOLD = 1.8 / SPEED;

function blockSpeed(W){
  return ((W*1.1+500)/6) * 0.85 * SPEED;
}

function catTravelTime(W,S){
  return (W + (RW_BASE+100)*S) / blockSpeed(W);
}

let state, raf;

function initState(){
  return {
    stage:0, t:0, gt:0,
    blockX:0, catFr:0, catFrT:0,
    fadeA:0, redirected:false
  };
}

function start(){
  if(raf) cancelAnimationFrame(raf);
  state=initState();
  let last=null;

  function loop(ts){
    if(!last) last=ts;
    const dt=Math.min((ts-last)/1000,0.05) * SPEED;
    last=ts;

    const W=canvas.width, H=canvas.height;
    const st=state;

    st.t+=dt;
    st.gt+=dt;

    const S=Math.min(W/900,1.17);
    const rW=RW_BASE*S;
    const catH=80*S;
    const totalBlockW=rW+100*S;
    const centerY=H/2;

    const ps=Math.round(Math.min(W/45,9));
    const labelGap=catH*2.5;

    ctx.fillStyle="#C98FAF";
    ctx.fillRect(0,0,W,H);

    if(st.stage<4) drawStars(st.gt,W,H);

    /* Stage 0 */
    if(st.stage===0 && st.t>1.5/SPEED){
      st.stage=1; st.t=0;
    }

    /* Stage 1 */
    if(st.stage===1){
      const tw=pixelW("NFT NYAN",ps);
      const tx=(W-tw)/2;
      const ty=H/2-(7*ps)/2;

      const printDur=0.5 / SPEED;
      const holdEnd=printDur+HOLD;
      const totalDur=holdEnd+FADE;

      let progress,alpha;

      if(st.t<printDur){ progress=st.t/printDur; alpha=1; }
      else if(st.t<holdEnd){ progress=1; alpha=1; }
      else { progress=1; alpha=1-(st.t-holdEnd)/FADE; }

      drawText(ctx,"NFT NYAN",tx,ty,ps,"white",progress,alpha);

      if(st.t>totalDur){
        st.stage=2; st.t=0;
        st.blockX=-totalBlockW;
      }
    }

    /* Stage 2 */
    if(st.stage===2){
      st.catFrT+=dt;
      if(st.catFrT>0.15 / SPEED){
        st.catFr=(st.catFr+1)%2;
        st.catFrT=0;
      }

      const spd=blockSpeed(W);
      st.blockX+=spd*dt;

      const {catX,catY}=drawNyanBlock(st.blockX,centerY,S,st.gt);
      drawCat(st.catFr,catX,catY,S);

      const travelT=catTravelTime(W,S);

      /* SEARCH OWNERS */
      const soStart=0.2 / SPEED;
      const soDur=0.4 / SPEED;
      const soFadeStart=travelT*0.55;
      const soFadeEnd=travelT*0.75;

      const soTw=pixelW("SEARCH OWNERS",ps);
      const soX=(W-soTw)/2;
      const soY=centerY-catH/2-labelGap;

      let soP=0, soA=0;
      if(st.t>soStart){
        const lt=st.t-soStart;
        soP=Math.min(lt/soDur,1);
        if(st.t<soFadeStart) soA=1;
        else if(st.t<soFadeEnd) soA=1-(st.t-soFadeStart)/(soFadeEnd-soFadeStart);
        else soA=0;
      }
      if(soA>0) drawText(ctx,"SEARCH OWNERS",soX,soY,ps,"white",soP,soA);

      /* BY TONILOON */
      const btStart=travelT*0.4;
      const btDur=0.4 / SPEED;
      const btFadeStart=travelT*0.72;
      const btFadeEnd=travelT*0.92;

      const btTw=pixelW("BY TONILOON",ps);
      const btX=(W-btTw)/2;
      const btY=centerY+catH/2+labelGap;

      let btP=0, btA=0;
      if(st.t>btStart){
        const lt=st.t-btStart;
        btP=Math.min(lt/btDur,1);
        if(st.t<btFadeStart) btA=1;
        else if(st.t<btFadeEnd) btA=1-(st.t-btFadeStart)/(btFadeEnd-btFadeStart);
        else btA=0;
      }
      if(btA>0) drawText(ctx,"BY TONILOON",btX,btY,ps,"#2F394E",btP,btA);

      if(st.blockX>W+50){
        st.stage=4; st.t=0;
      }
    }

    /* Stage 4 — fade to black */
    if(st.stage===4){
      st.fadeA=Math.min(st.t/(0.8/SPEED),1);
      ctx.fillStyle="#0f0f0f";
      ctx.globalAlpha=st.fadeA;
      ctx.fillRect(0,0,W,H);
      ctx.globalAlpha=1;

      if(st.fadeA>=1) st.stage=5;
    }

    /* Stage 5 — redirect */
    if(st.stage===5 && !st.redirected){
      st.redirected=true;
      document.body.style.opacity="0";
      setTimeout(()=>{
        location.href="https://seegifts-front.onrender.com";
      },800/SPEED);
    }

    if(st.stage<5) raf=requestAnimationFrame(loop);
  }

  raf=requestAnimationFrame(loop);
}

start();
</script>
</body>
</html>
